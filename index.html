<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streaming Webpage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        #thumbnail {
            width: 300px;
            cursor: pointer;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<h1>Stream Video from WD My Home Cloud</h1>

<!-- Thumbnail of the video -->
<img id="thumbnail" src="thumbnail.jpg" alt="Video Thumbnail" onclick="fetchTokenAndPlay()">

<!-- Play Button -->
<button id="playButton" style="display: none;" onclick="playVideo()">Play Video</button>

<script>
    function fetchTokenAndPlay() {
        const videoLink = 'https://home.mycloud.com/action/share/1cb51cb1-fdaa-4ca5-8270-db73eac5d365'; 
        
        // Fetch HTML content from the video link
        fetch(videoLink)
            .then(response => response.text())
            .then(data => {
                // Find the token in the HTML content
                const tokenMatch = data.match(/content="https:\/\/prod-940b1d9bbad9901.wdckeystone.com\/.*content\?access_token=([^"]+)"/);
                
                if (tokenMatch) {
                    const token = tokenMatch[1];
                    const streamingUrl = `vlc://https://prod-940b1d9bbad9901.wdckeystone.com/9e7f3dc5-7a69-44a2-9672-b444b60548a0/sdk/v3/files/mksoaae4wh3rwd53mbliy2hv/content?access_token=${token}`;
                    
                    // Display the play button and enable it
                    document.getElementById('playButton').style.display = 'inline-block';
                    
                    // Store the final URL in a variable for later use
                    window.streamingUrl = streamingUrl;
                } else {
                    alert("Token not found. Could not generate stream URL.");
                }
            })
            .catch(error => {
                console.error('Error fetching HTML:', error);
                alert("An error occurred while fetching the token.");
            });
    }

    function playVideo() {
        // Play the video using the VLC URL
        if (window.streamingUrl) {
            window.location.href = window.streamingUrl;  // Use the VLC URL
        } else {
            alert("No valid streaming URL available.");
        }
    }
</script>

</body>
</html>
